<launch>
  <arg name="param_path" default="$(find-pkg-share autoware_autonomous_emergency_braking)/config/autonomous_emergency_braking.param.yaml"/>
  <arg name="input_pointcloud" default="/perception/obstacle_segmentation/pointcloud"/>
  <arg name="input_velocity" default="/vehicle/status/velocity_status"/>
  <arg name="input_imu" default="/sensing/imu/imu_data"/>
  <arg name="input_odometry" default="/localization/kinematic_state"/>
  <arg name="input_predicted_trajectory" default="/control/trajectory_follower/lateral/predicted_trajectory"/>
  <arg name="input_objects" default="/perception/object_recognition/objects"/>

  <load_composable_node target="/control/control_check_container">
    <composable_node pkg="autoware_autonomous_emergency_braking" 
                     plugin="autoware::motion::control::autonomous_emergency_braking::AEB" 
                     name="autonomous_emergency_braking">
      <param from="$(var param_path)"/>
      
      <remap from="~/input/pointcloud" to="$(var input_pointcloud)"/>
      <remap from="~/input/velocity" to="$(var input_velocity)"/>
      <remap from="~/input/imu" to="$(var input_imu)"/>
      <remap from="~/input/odometry" to="$(var input_odometry)"/>
      <remap from="~/input/predicted_trajectory" to="$(var input_predicted_trajectory)"/>
      <remap from="~/input/objects" to="$(var input_objects)"/>
      
      <extra_arg name="use_intra_process_comms" value="true"/>
    </composable_node>
  </load_composable_node>
</launch>